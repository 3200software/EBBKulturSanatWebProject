<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Etkinlik Detayı - EBB Kültür Sanat</title>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/global.css" />

    <style>
      body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      .header {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
        position: sticky;
        top: 0;
        z-index: 1000;
      }

      .event-hero {
        background: linear-gradient(rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.6));
        background-size: cover;
        background-position: center;
        min-height: 400px;
        display: flex;
        align-items: center;
        color: white;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
      }

      .event-content {
        background: white;
        border-radius: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        margin-top: -50px;
        position: relative;
        z-index: 10;
      }

      .info-card {
        background: linear-gradient(135deg, #f8f9fa, #e9ecef);
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 20px;
        border: none;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
      }

      .info-item {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
        padding: 10px;
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
      }

      .info-item:last-child {
        margin-bottom: 0;
      }

      .info-icon {
        width: 40px;
        height: 40px;
        background: linear-gradient(135deg, #007bff, #0056b3);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        margin-right: 15px;
        font-size: 16px;
      }

      .staff-card {
        background: linear-gradient(135deg, #28a745, #20c997);
        color: white;
        border-radius: 15px;
        padding: 25px;
        margin-bottom: 20px;
      }

      .staff-member {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 15px;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .staff-member:last-child {
        margin-bottom: 0;
      }

      .staff-role {
        font-weight: bold;
        font-size: 14px;
        opacity: 0.9;
        margin-bottom: 5px;
      }

      .staff-name {
        font-size: 18px;
        font-weight: 600;
      }

      .btn-custom {
        background: linear-gradient(135deg, #007bff, #0056b3);
        border: none;
        border-radius: 25px;
        padding: 12px 30px;
        color: white;
        font-weight: 600;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        transition: all 0.3s ease;
      }

      .btn-custom:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 123, 255, 0.4);
        color: white;
      }

      .btn-back {
        background: linear-gradient(135deg, #6c757d, #495057);
      }

      .btn-back:hover {
        box-shadow: 0 5px 15px rgba(108, 117, 125, 0.4);
      }

      .event-badge {
        background: linear-gradient(135deg, #ffc107, #fd7e14);
        color: white;
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 14px;
        font-weight: 600;
        display: inline-block;
        margin-bottom: 15px;
      }

      .loading-spinner {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 400px;
      }

      .error-message {
        text-align: center;
        padding: 50px 20px;
        color: #dc3545;
      }

      @media (max-width: 768px) {
        .event-hero {
          min-height: 300px;
          text-align: center;
        }

        .event-content {
          margin-top: -30px;
          border-radius: 15px 15px 0 0;
        }

        .info-item {
          flex-direction: column;
          text-align: center;
        }

        .info-icon {
          margin-right: 0;
          margin-bottom: 10px;
        }
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <div class="header">
      <div class="container">
        <div class="d-flex justify-content-between align-items-center py-3">
          <div class="d-flex align-items-center">
            <img
              src="assets/274348852_320609883437173_4953649348556891409_n.jpg"
              alt="EBB Logo"
              width="50"
              height="50"
              class="rounded-circle me-3"
            />
            <h5 class="mb-0 text-primary">EBB Kültür Sanat</h5>
          </div>
          <a href="calendar.html" class="btn-custom btn-back">
            <i class="fas fa-arrow-left me-2"></i>Takvime Dön
          </a>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div id="loadingState" class="loading-spinner">
      <div class="text-center">
        <i class="fas fa-spinner fa-spin fa-3x text-white mb-3"></i>
        <h4 class="text-white">Etkinlik yükleniyor...</h4>
      </div>
    </div>

    <!-- Error State -->
    <div id="errorState" class="error-message" style="display: none">
      <div class="container">
        <i class="fas fa-exclamation-triangle fa-3x mb-3"></i>
        <h3>Etkinlik Bulunamadı</h3>
        <p>Aradığınız etkinlik bulunamadı veya bir hata oluştu.</p>
        <a href="calendar.html" class="btn-custom">
          <i class="fas fa-arrow-left me-2"></i>Takvime Dön
        </a>
      </div>
    </div>

    <!-- Main Content -->
    <div id="mainContent" style="display: none">
      <!-- Event Hero Section -->
      <div class="event-hero" id="eventHero">
        <div class="container">
          <div class="row">
            <div class="col-lg-8">
              <div class="event-badge" id="eventCategory">Konser</div>
              <h1 class="display-4 fw-bold mb-3" id="eventTitle">
                Etkinlik Adı
              </h1>
              <p class="lead mb-4" id="eventDescription">
                Etkinlik açıklaması...
              </p>
              <div class="d-flex flex-wrap gap-3">
                <div class="d-flex align-items-center">
                  <i class="fas fa-calendar me-2"></i>
                  <span id="eventDate">Tarih</span>
                </div>
                <div class="d-flex align-items-center">
                  <i class="fas fa-clock me-2"></i>
                  <span id="eventTime">Saat</span>
                </div>
                <div class="d-flex align-items-center">
                  <i class="fas fa-map-marker-alt me-2"></i>
                  <span id="eventLocation">Konum</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Event Content -->
      <div class="container">
        <div class="event-content p-4 p-md-5">
          <div class="row">
            <!-- Event Information -->
            <div class="col-lg-8">
              <h3 class="mb-4">
                <i class="fas fa-info-circle me-2 text-primary"></i>
                Etkinlik Bilgileri
              </h3>

              <div class="info-card">
                <div class="info-item">
                  <div class="info-icon">
                    <i class="fas fa-calendar"></i>
                  </div>
                  <div>
                    <strong>Tarih ve Saat</strong><br />
                    <span id="eventDateTime">-</span>
                  </div>
                </div>

                <div class="info-item">
                  <div class="info-icon">
                    <i class="fas fa-map-marker-alt"></i>
                  </div>
                  <div>
                    <strong>Konum</strong><br />
                    <span id="eventLocationDetail">-</span>
                  </div>
                </div>

                <div class="info-item">
                  <div class="info-icon">
                    <i class="fas fa-tag"></i>
                  </div>
                  <div>
                    <strong>Kategori</strong><br />
                    <span id="eventCategoryDetail">-</span>
                  </div>
                </div>

                <div
                  class="info-item"
                  id="registrationItem"
                  style="display: none"
                >
                  <div class="info-icon">
                    <i class="fas fa-ticket-alt"></i>
                  </div>
                  <div>
                    <strong>Kayıt</strong><br />
                    <a
                      href="#"
                      id="registrationLink"
                      class="btn-custom btn-sm"
                      target="_blank"
                    >
                      <i class="fas fa-external-link-alt me-1"></i>Kayıt Ol
                    </a>
                  </div>
                </div>
              </div>

              <!-- Event Description -->
              <div id="eventDescriptionSection" style="display: none">
                <h4 class="mb-3">
                  <i class="fas fa-align-left me-2 text-primary"></i>
                  Açıklama
                </h4>
                <div class="info-card">
                  <p id="eventFullDescription" class="mb-0"></p>
                </div>
              </div>
            </div>

            <!-- Sidebar -->
            <div class="col-lg-4">
              <!-- Event Poster -->
              <div id="eventPosterSection" style="display: none">
                <h4 class="mb-3">
                  <i class="fas fa-image me-2 text-primary"></i>
                  Afiş
                </h4>
                <div class="text-center mb-4">
                  <img
                    id="eventPoster"
                    src=""
                    alt="Etkinlik Afişi"
                    class="img-fluid rounded shadow"
                  />
                </div>
              </div>

              <!-- Theater Staff -->
              <div id="theaterStaffSection" style="display: none">
                <h4 class="mb-3">
                  <i class="fas fa-theater-masks me-2 text-primary"></i>
                  Tiyatro Kadrosu
                </h4>
                <div class="staff-card">
                  <div id="staffContainer">
                    <!-- Staff members will be loaded here -->
                  </div>
                </div>
              </div>

              <!-- Action Buttons -->
              <div class="d-grid gap-2">
                <a href="calendar.html" class="btn-custom btn-back">
                  <i class="fas fa-arrow-left me-2"></i>
                  Takvime Dön
                </a>
                <button class="btn-custom" onclick="shareEvent()">
                  <i class="fas fa-share-alt me-2"></i>
                  Paylaş
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Firebase -->
    <script type="module">
      // Firebase imports
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
      import {
        getFirestore,
        collection,
        doc,
        getDoc,
        getDocs,
      } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

      // Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyD978ixFjE9KVlNsm6-BYww3B6S4qPVLfQ",
        authDomain: "ebbkultursanatapp.firebaseapp.com",
        projectId: "ebbkultursanatapp",
        storageBucket: "ebbkultursanatapp.appspot.com",
        messagingSenderId: "540910775157",
        appId: "1:540910775157:web:4af35312414acf20bd013c",
        measurementId: "G-4JCKV13ER8",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      // Get event ID from URL parameters
      function getEventIdFromUrl() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get("id");
      }

      // Load event details
      async function loadEventDetails() {
        const eventId = getEventIdFromUrl();

        if (!eventId) {
          showError();
          return;
        }

        try {
          // Load event data
          const eventRef = doc(db, "activity", eventId);
          const eventSnap = await getDoc(eventRef);

          if (!eventSnap.exists()) {
            showError();
            return;
          }

          const eventData = eventSnap.data();
          const event = {
            id: eventSnap.id,
            ...eventData,
            date: eventData.date ? eventData.date.toDate() : new Date(),
          };

          // Display event details
          displayEvent(event);

          // Load theater staff if it's a theater event
          if (event.category === "Tiyatro") {
            await loadTheaterStaff(eventId);
          }

          // Hide loading, show content
          document.getElementById("loadingState").style.display = "none";
          document.getElementById("mainContent").style.display = "block";
        } catch (error) {
          console.error("Error loading event:", error);
          showError();
        }
      }

      // Display event details
      function displayEvent(event) {
        // Set page title
        document.title = `${event.name} - EBB Kültür Sanat`;

        // Hero section
        document.getElementById("eventTitle").textContent = event.name;
        document.getElementById("eventCategory").textContent =
          event.category || "Etkinlik";
        document.getElementById("eventDate").textContent =
          event.date.toLocaleDateString("tr-TR");
        document.getElementById("eventTime").textContent =
          event.time || "00:00";
        document.getElementById("eventLocation").textContent =
          event.location || "Belirtilmemiş";

        // Set hero background image
        const heroSection = document.getElementById("eventHero");
        if (event.imageUrl) {
          heroSection.style.backgroundImage = `linear-gradient(rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.6)), url(${event.imageUrl})`;
        }

        // Event information
        document.getElementById(
          "eventDateTime"
        ).textContent = `${event.date.toLocaleDateString("tr-TR")} - ${
          event.time || "00:00"
        }`;
        document.getElementById("eventLocationDetail").textContent =
          event.location || "Belirtilmemiş";
        document.getElementById("eventCategoryDetail").textContent =
          event.category || "Genel";

        // Description
        if (event.description) {
          document.getElementById("eventDescription").textContent =
            event.description;
          document.getElementById("eventFullDescription").textContent =
            event.description;
          document.getElementById("eventDescriptionSection").style.display =
            "block";
        }

        // Registration link
        if (event.registrationUrl) {
          document.getElementById("registrationLink").href =
            event.registrationUrl;
          document.getElementById("registrationItem").style.display = "block";
        }

        // Event poster
        if (event.posterImageUrl) {
          document.getElementById("eventPoster").src = event.posterImageUrl;
          document.getElementById("eventPosterSection").style.display = "block";
        }
      }

      // Load theater staff
      async function loadTheaterStaff(eventId) {
        try {
          const staffRef = collection(db, "activity", eventId, "staff");
          const querySnapshot = await getDocs(staffRef);

          const staffList = [];
          querySnapshot.forEach((doc) => {
            const data = doc.data();
            staffList.push({
              role: data.role,
              name: data.name,
              photoUrl: data.photoUrl || "",
            });
          });

          if (staffList.length > 0) {
            displayTheaterStaff(staffList);
          }
        } catch (error) {
          console.error("Error loading theater staff:", error);
        }
      }

      // Display theater staff
      function displayTheaterStaff(staffList) {
        const container = document.getElementById("staffContainer");

        container.innerHTML = staffList
          .map(
            (staff) => `
                 <div class="staff-member">
                     <div class="d-flex align-items-center mb-3">
                         ${
                           staff.photoUrl
                             ? `
                             <img src="${staff.photoUrl}" alt="${staff.name}" 
                                  style="width: 60px; height: 60px; border-radius: 50%; object-fit: cover; margin-right: 15px; border: 3px solid rgba(255,255,255,0.3);">
                         `
                             : `
                             <div style="width: 60px; height: 60px; border-radius: 50%; background: rgba(255,255,255,0.2); 
                                        display: flex; align-items: center; justify-content: center; margin-right: 15px; border: 3px solid rgba(255,255,255,0.3);">
                                 <i class="fas fa-user" style="font-size: 24px; opacity: 0.7;"></i>
                             </div>
                         `
                         }
                         <div>
                             <div class="staff-role">${staff.role}</div>
                             <div class="staff-name">${staff.name}</div>
                         </div>
                     </div>
                 </div>
             `
          )
          .join("");

        document.getElementById("theaterStaffSection").style.display = "block";
      }

      // Show error state
      function showError() {
        document.getElementById("loadingState").style.display = "none";
        document.getElementById("errorState").style.display = "block";
      }

      // Share event function
      window.shareEvent = function () {
        if (navigator.share) {
          navigator.share({
            title: document.getElementById("eventTitle").textContent,
            text: document.getElementById("eventDescription").textContent,
            url: window.location.href,
          });
        } else {
          // Fallback: copy URL to clipboard
          navigator.clipboard.writeText(window.location.href).then(() => {
            alert("Etkinlik linki panoya kopyalandı!");
          });
        }
      };

      // Initialize page
      document.addEventListener("DOMContentLoaded", function () {
        loadEventDetails();
      });
    </script>
  </body>
</html>
