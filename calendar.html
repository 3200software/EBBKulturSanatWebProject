<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Program Takvimi | EBB Kültür ve Sanat Merkezi</title>

    <!-- SEO Meta Tags -->
    <meta
      name="description"
      content="EBB Kültür ve Sanat Merkezi program takvimi. Tüm etkinliklerimizi tarih bazında görüntüleyin."
    />
    <meta
      name="keywords"
      content="Erzurum, kültür, sanat, etkinlik, takvim, program"
    />

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="assets/Asset 1.png" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />

    <!-- Styles -->
    <style>
      :root {
        --primary-color: #2c5aa0;
        --secondary-color: #4a90c2;
        --accent-color: #f39c12;
        --text-dark: #2c3e50;
        --text-light: #7f8c8d;
        --bg-light: #f8f9fa;
        --bg-white: #ffffff;
        --shadow-light: 0 2px 10px rgba(0, 0, 0, 0.1);
        --shadow-medium: 0 4px 20px rgba(0, 0, 0, 0.15);
        --shadow-heavy: 0 8px 30px rgba(0, 0, 0, 0.2);
        --border-radius: 12px;
        --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        --font-primary: "Inter", -apple-system, BlinkMacSystemFont, sans-serif;
        --font-display: "Playfair Display", serif;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: var(--font-primary);
        line-height: 1.6;
        color: var(--text-dark);
        background-color: var(--bg-light);
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
      }

      /* Header */
      .header {
        background: white;
        box-shadow: var(--shadow-light);
        padding: 1rem 0;
        margin-bottom: 2rem;
      }

      .nav {
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 12px;
        text-decoration: none;
        color: var(--primary-color);
        font-weight: 700;
        font-size: 1.2rem;
      }

      .logo img {
        width: 50px;
        height: 50px;
        border-radius: 8px;
      }

      .back-btn {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem 1.5rem;
        background: var(--primary-color);
        color: white;
        text-decoration: none;
        border-radius: var(--border-radius);
        transition: var(--transition);
      }

      .back-btn:hover {
        background: var(--secondary-color);
        transform: translateY(-2px);
      }

      /* Calendar Container */
      .calendar-container {
        display: grid;
        grid-template-columns: 1fr 400px;
        gap: 2rem;
        margin-bottom: 2rem;
      }

      /* Calendar */
      .calendar-section {
        background: white;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-medium);
        overflow: hidden;
      }

      .calendar-header {
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--secondary-color)
        );
        color: white;
        padding: 2rem;
        text-align: center;
      }

      .calendar-title {
        font-family: var(--font-display);
        font-size: 2rem;
        margin-bottom: 0.5rem;
      }

      .calendar-subtitle {
        opacity: 0.9;
      }

      .calendar-nav {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 1.5rem 2rem;
        border-bottom: 1px solid #e9ecef;
      }

      .nav-btn {
        background: none;
        border: none;
        color: var(--primary-color);
        font-size: 1.5rem;
        cursor: pointer;
        padding: 0.5rem;
        border-radius: 50%;
        transition: var(--transition);
      }

      .nav-btn:hover {
        background: var(--bg-light);
        transform: scale(1.1);
      }

      .current-month {
        font-size: 1.5rem;
        font-weight: 600;
        color: var(--text-dark);
      }

      .calendar-grid {
        padding: 1.5rem;
      }

      .weekdays {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 1px;
        margin-bottom: 1rem;
      }

      .weekday {
        text-align: center;
        padding: 1rem 0.5rem;
        font-weight: 600;
        color: var(--text-light);
        font-size: 0.9rem;
      }

      .days {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 1px;
      }

      .day {
        position: relative;
        aspect-ratio: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        border-radius: 8px;
        transition: var(--transition);
        font-weight: 500;
      }

      .day:hover {
        background: var(--bg-light);
      }

      .day.other-month {
        color: var(--text-light);
        opacity: 0.5;
      }

      .day.today {
        background: var(--accent-color);
        color: white;
        font-weight: 700;
      }

      .day.selected {
        background: var(--primary-color);
        color: white;
      }

      .day.has-events {
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--secondary-color)
        );
        color: white;
      }

      .day.has-events::after {
        content: "";
        position: absolute;
        bottom: 4px;
        left: 50%;
        transform: translateX(-50%);
        width: 6px;
        height: 6px;
        background: var(--accent-color);
        border-radius: 50%;
      }

      /* Events Panel */
      .events-panel {
        background: white;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-medium);
        overflow: hidden;
        max-height: 600px;
        display: flex;
        flex-direction: column;
      }

      .events-header {
        background: var(--bg-light);
        padding: 1.5rem;
        border-bottom: 1px solid #e9ecef;
      }

      .selected-date {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--text-dark);
        margin-bottom: 0.5rem;
      }

      .events-count {
        color: var(--text-light);
        font-size: 0.9rem;
      }

      .events-list {
        flex: 1;
        overflow-y: auto;
        padding: 1rem;
      }

      .event-item {
        background: var(--bg-light);
        border-radius: var(--border-radius);
        padding: 1.5rem;
        margin-bottom: 1rem;
        transition: var(--transition);
        border-left: 4px solid var(--primary-color);
      }

      .event-item:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-light);
      }

      .event-time {
        display: inline-block;
        background: var(--primary-color);
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
        margin-bottom: 0.75rem;
      }

      .event-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--text-dark);
        margin-bottom: 0.5rem;
      }

      .event-description {
        color: var(--text-light);
        font-size: 0.9rem;
        margin-bottom: 1rem;
        line-height: 1.5;
      }

      .event-meta {
        display: flex;
        gap: 1rem;
        margin-bottom: 1rem;
        font-size: 0.85rem;
        color: var(--text-light);
      }

      .event-location,
      .event-category {
        display: flex;
        align-items: center;
        gap: 0.25rem;
      }

      .event-actions {
        display: flex;
        gap: 0.5rem;
      }

      .btn {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        border: none;
        border-radius: var(--border-radius);
        font-weight: 500;
        text-decoration: none;
        cursor: pointer;
        transition: var(--transition);
        font-size: 0.85rem;
      }

      .btn-primary {
        background: var(--primary-color);
        color: white;
      }

      .btn-primary:hover {
        background: var(--secondary-color);
        transform: translateY(-1px);
      }

      .btn-outline {
        background: transparent;
        color: var(--primary-color);
        border: 1px solid var(--primary-color);
      }

      .btn-outline:hover {
        background: var(--primary-color);
        color: white;
      }

      .no-events {
        text-align: center;
        padding: 3rem 2rem;
        color: var(--text-light);
      }

      .no-events i {
        font-size: 3rem;
        margin-bottom: 1rem;
        opacity: 0.5;
      }

      .loading {
        text-align: center;
        padding: 2rem;
        color: var(--text-light);
      }

      .loading-spinner {
        width: 40px;
        height: 40px;
        border: 4px solid #f3f3f3;
        border-top: 4px solid var(--primary-color);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 1rem;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* Responsive */
      @media (max-width: 992px) {
        .calendar-container {
          grid-template-columns: 1fr;
        }

        .events-panel {
          max-height: 400px;
        }
      }

      @media (max-width: 768px) {
        .container {
          padding: 0 15px;
        }

        .calendar-nav {
          padding: 1rem;
        }

        .calendar-grid {
          padding: 1rem;
        }

        .weekday {
          padding: 0.5rem 0.25rem;
          font-size: 0.8rem;
        }

        .day {
          font-size: 0.9rem;
        }

        .events-header {
          padding: 1rem;
        }

        .event-item {
          padding: 1rem;
        }

        .event-meta {
          flex-direction: column;
          gap: 0.5rem;
        }
      }

      @media (max-width: 480px) {
        .nav {
          flex-direction: column;
          gap: 1rem;
        }

        .calendar-title {
          font-size: 1.5rem;
        }

        .current-month {
          font-size: 1.25rem;
        }
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <header class="header">
      <nav class="nav container">
        <a href="index.html" class="logo">
          <img src="assets/Asset 1.png" alt="EBB Logo" />
          <span>EBB Kültür Sanat</span>
        </a>

        <a href="index.html" class="back-btn">
          <i class="fas fa-arrow-left"></i>
          Ana Sayfaya Dön
        </a>
      </nav>
    </header>

    <!-- Main Content -->
    <main class="container">
      <div class="calendar-container">
        <!-- Calendar Section -->
        <div class="calendar-section">
          <div class="calendar-header">
            <h1 class="calendar-title">Program Takvimi</h1>
            <p class="calendar-subtitle">
              Etkinliklerimizi keşfedin ve katılın
            </p>
          </div>

          <div class="calendar-nav">
            <button class="nav-btn" id="prevMonth">
              <i class="fas fa-chevron-left"></i>
            </button>
            <div class="current-month" id="currentMonth"></div>
            <button class="nav-btn" id="nextMonth">
              <i class="fas fa-chevron-right"></i>
            </button>
          </div>

          <div class="calendar-grid">
            <div class="weekdays">
              <div class="weekday">Pzt</div>
              <div class="weekday">Sal</div>
              <div class="weekday">Çar</div>
              <div class="weekday">Per</div>
              <div class="weekday">Cum</div>
              <div class="weekday">Cmt</div>
              <div class="weekday">Paz</div>
            </div>
            <div class="days" id="calendarDays"></div>
          </div>
        </div>

        <!-- Events Panel -->
        <div class="events-panel">
          <div class="events-header">
            <div class="selected-date" id="selectedDate">Bugün</div>
            <div class="events-count" id="eventsCount">
              Etkinlikler yükleniyor...
            </div>
          </div>
          <div class="events-list" id="eventsList">
            <div class="loading">
              <div class="loading-spinner"></div>
              <p>Etkinlikler yükleniyor...</p>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Firebase -->
    <script type="module">
      // Firebase imports
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
      import {
        getFirestore,
        collection,
        getDocs,
        query,
        where,
        orderBy,
      } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

      // Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyD978ixFjE9KVlNsm6-BYww3B6S4qPVLfQ",
        authDomain: "ebbkultursanatapp.firebaseapp.com",
        projectId: "ebbkultursanatapp",
        storageBucket: "ebbkultursanatapp.appspot.com",
        messagingSenderId: "540910775157",
        appId: "1:540910775157:web:4af35312414acf20bd013c",
        measurementId: "G-4JCKV13ER8",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      // Calendar functionality
      class EventCalendar {
        constructor() {
          this.currentDate = new Date();
          this.selectedDate = new Date();
          this.events = [];
          this.eventsByDate = new Map();

          this.init();
        }

        async init() {
          await this.loadEvents();
          this.renderCalendar();
          this.loadEventsForDate(this.selectedDate);
          this.setupEventListeners();
        }

        async loadEvents() {
          try {
            const eventsRef = collection(db, "activity");
            const querySnapshot = await getDocs(eventsRef);

            this.events = [];
            this.eventsByDate.clear();

            querySnapshot.forEach((doc) => {
              const data = doc.data();
              const event = {
                id: doc.id,
                ...data,
                date: data.date
                  ? new Date(data.date.seconds * 1000)
                  : new Date(),
              };

              this.events.push(event);

              // Group events by date
              const dateKey = this.getDateKey(event.date);
              if (!this.eventsByDate.has(dateKey)) {
                this.eventsByDate.set(dateKey, []);
              }
              this.eventsByDate.get(dateKey).push(event);
            });

            console.log("Events loaded:", this.events.length);
          } catch (error) {
            console.error("Error loading events:", error);
          }
        }

        getDateKey(date) {
          return `${date.getFullYear()}-${date.getMonth()}-${date.getDate()}`;
        }

        renderCalendar() {
          const year = this.currentDate.getFullYear();
          const month = this.currentDate.getMonth();

          // Update month display
          const monthNames = [
            "Ocak",
            "Şubat",
            "Mart",
            "Nisan",
            "Mayıs",
            "Haziran",
            "Temmuz",
            "Ağustos",
            "Eylül",
            "Ekim",
            "Kasım",
            "Aralık",
          ];
          document.getElementById(
            "currentMonth"
          ).textContent = `${monthNames[month]} ${year}`;

          // Get first day of month and number of days
          const firstDay = new Date(year, month, 1);
          const lastDay = new Date(year, month + 1, 0);
          const daysInMonth = lastDay.getDate();
          const startingDayOfWeek = (firstDay.getDay() + 6) % 7; // Monday = 0

          // Clear calendar
          const calendarDays = document.getElementById("calendarDays");
          calendarDays.innerHTML = "";

          // Add empty cells for days before month starts
          for (let i = 0; i < startingDayOfWeek; i++) {
            const prevMonthDay = new Date(
              year,
              month,
              -startingDayOfWeek + i + 1
            );
            const dayElement = this.createDayElement(prevMonthDay, true);
            calendarDays.appendChild(dayElement);
          }

          // Add days of current month
          for (let day = 1; day <= daysInMonth; day++) {
            const date = new Date(year, month, day);
            const dayElement = this.createDayElement(date, false);
            calendarDays.appendChild(dayElement);
          }

          // Add days from next month to fill grid
          const totalCells = calendarDays.children.length;
          const remainingCells = 42 - totalCells; // 6 rows × 7 days
          for (let day = 1; day <= remainingCells; day++) {
            const nextMonthDay = new Date(year, month + 1, day);
            const dayElement = this.createDayElement(nextMonthDay, true);
            calendarDays.appendChild(dayElement);
          }
        }

        createDayElement(date, isOtherMonth) {
          const dayElement = document.createElement("div");
          dayElement.className = "day";
          dayElement.textContent = date.getDate();

          if (isOtherMonth) {
            dayElement.classList.add("other-month");
          }

          // Check if it's today
          const today = new Date();
          if (this.isSameDate(date, today)) {
            dayElement.classList.add("today");
          }

          // Check if it's selected
          if (this.isSameDate(date, this.selectedDate)) {
            dayElement.classList.add("selected");
          }

          // Check if it has events
          const dateKey = this.getDateKey(date);
          if (this.eventsByDate.has(dateKey)) {
            dayElement.classList.add("has-events");
          }

          // Add click event
          dayElement.addEventListener("click", () => {
            this.selectDate(date);
          });

          return dayElement;
        }

        selectDate(date) {
          this.selectedDate = new Date(date);
          this.renderCalendar();
          this.loadEventsForDate(date);
        }

        loadEventsForDate(date) {
          const dateKey = this.getDateKey(date);
          const dayEvents = this.eventsByDate.get(dateKey) || [];

          // Update selected date display
          const selectedDateElement = document.getElementById("selectedDate");
          const eventsCountElement = document.getElementById("eventsCount");

          const options = {
            weekday: "long",
            year: "numeric",
            month: "long",
            day: "numeric",
          };
          selectedDateElement.textContent = date.toLocaleDateString(
            "tr-TR",
            options
          );
          eventsCountElement.textContent = `${dayEvents.length} etkinlik`;

          // Render events
          this.renderEvents(dayEvents);
        }

        renderEvents(events) {
          const eventsListElement = document.getElementById("eventsList");

          if (events.length === 0) {
            eventsListElement.innerHTML = `
                        <div class="no-events">
                            <i class="fas fa-calendar-times"></i>
                            <p>Bu tarihte etkinlik bulunmamaktadır.</p>
                        </div>
                    `;
            return;
          }

          eventsListElement.innerHTML = events
            .map(
              (event) => `
                    <div class="event-item">
                        <div class="event-time">
                            <i class="fas fa-clock"></i>
                            ${this.formatTime(event.time || "00:00")}
                        </div>
                        <div class="event-title">${
                          event.name || "Etkinlik"
                        }</div>
                        <div class="event-description">${
                          event.description || "Açıklama bulunmamaktadır."
                        }</div>
                        <div class="event-meta">
                            <div class="event-location">
                                <i class="fas fa-map-marker-alt"></i>
                                ${event.location || "Konum belirtilmemiş"}
                            </div>
                            <div class="event-category">
                                <i class="fas fa-tag"></i>
                                ${event.category || "Genel"}
                            </div>
                        </div>
                        <div class="event-actions">
                            <button class="btn btn-primary" onclick="showEventDetails('${
                              event.id
                            }')">
                                <i class="fas fa-info-circle"></i>
                                Detaylar
                            </button>
                            ${
                              event.registrationUrl
                                ? `
                                <a href="${event.registrationUrl}" class="btn btn-outline" target="_blank">
                                    <i class="fas fa-external-link-alt"></i>
                                    Kayıt Ol
                                </a>
                            `
                                : ""
                            }
                        </div>
                    </div>
                `
            )
            .join("");
        }

        formatTime(timeString) {
          try {
            const [hours, minutes] = timeString.split(":");
            return `${hours.padStart(2, "0")}:${minutes.padStart(2, "0")}`;
          } catch (error) {
            return timeString;
          }
        }

        isSameDate(date1, date2) {
          return (
            date1.getFullYear() === date2.getFullYear() &&
            date1.getMonth() === date2.getMonth() &&
            date1.getDate() === date2.getDate()
          );
        }

        setupEventListeners() {
          document.getElementById("prevMonth").addEventListener("click", () => {
            this.currentDate.setMonth(this.currentDate.getMonth() - 1);
            this.renderCalendar();
          });

          document.getElementById("nextMonth").addEventListener("click", () => {
            this.currentDate.setMonth(this.currentDate.getMonth() + 1);
            this.renderCalendar();
          });
        }
      }

      // Global function for event details
      window.showEventDetails = function (eventId) {
        // Bu fonksiyon etkinlik detaylarını gösterecek
        // Şimdilik alert ile gösteriyoruz, daha sonra modal yapılabilir
        alert(`Etkinlik detayları: ${eventId}`);
      };

      // Initialize calendar when page loads
      document.addEventListener("DOMContentLoaded", () => {
        new EventCalendar();
      });
    </script>
  </body>
</html>
